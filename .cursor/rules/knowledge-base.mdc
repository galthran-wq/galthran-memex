---
description: Rules for adding, updating, and organizing knowledge base entries
globs: knowledge/**/*.md
alwaysApply: true
---

You are working on a personal knowledge base repository. Your task is to add, update, or reorganize knowledge entries based on the provided summary.

# Entry Format

Every entry is a single Markdown file at `knowledge/{slug}.md` where slug is lowercase-hyphenated derived from the title.

## Frontmatter Schema (YAML)

```yaml
---
title: "Human-Readable Title"
type: concept            # one of: concept, reference, insight, question, note
summary: "1-2 sentence essence of this entry"
tags: [topic1, topic2]   # freeform classification tags
created: "YYYY-MM-DD"
updated: "YYYY-MM-DD"    # set when modifying an existing entry
edges:
  - path: /knowledge/other-entry.md
    label: uses           # relationship type
    description: "Why this connection exists"
sources:
  - url: "https://..."
    title: "Source Title"
---
```

Required fields: `title`, `type`, `summary`, `tags`, `created`.
Optional fields: `updated`, `edges`, `sources`.

## Entry Types

Entries are tagged with a type for classification:
- **concept** — fundamental ideas, techniques, methods
- **reference** — papers, articles, external sources
- **insight** — observations, realizations, connections discovered
- **question** — open questions, things to explore
- **note** — everything else

The body structure is flexible. Organize content in whatever way best serves the material — use sections that make sense for the specific entry. Never create empty sections.

## Writing Style

Entries should be **succinct, to-the-point, and formal**. Prefer mathematical formulations and technical precision over verbose explanations.

For papers (type: reference):
- Prioritize **algorithms** (use LaTeX for pseudocode or equation form)
- Include **figures** when available (use images from `knowledge/assets/`)
- Extract **mathematical formulations** (definitions, theorems, key equations)
- Keep prose minimal — focus on what can be expressed formally

For concepts:
- Lead with formal definitions using math notation when applicable
- Use equations to capture relationships
- Keep explanatory text concise

## Presenting Material to User

When reading papers or textbooks with the user, follow these guidelines:

1. **Expert-level discourse**: User is knowledgeable. Be succinct, formal. Prefer math/pseudo-code over prose.
2. **Presentation plan first**: Before diving in, determine what's important and how to structure the presentation.
3. **Systematic progression**: Go section-by-section for papers. Don't rush ahead.
4. **Note connections**: Briefly indicate backward links (what's already in KB) and forward links (material not yet covered).
5. **Assume user hasn't read the source**: Present the material as the best possible guide.

## Edge Labels

Common edge labels (not exhaustive — use what fits):
- `uses` — A uses B as a component
- `based_on` — A is built on top of B
- `alternative` — A is an alternative to B
- `extends` — A extends or builds upon B
- `source` — A was learned from B (a reference entry)
- `example_of` — A is an example of B
- `requires` — A requires understanding of B
- `contradicts` — A contradicts or challenges B
- `answers` — A answers the question in B
- `about` — A is about B (generic)

# Images

Images live in `knowledge/assets/`. Reference them in entry bodies with standard markdown:

```
![Figure description](/knowledge/assets/filename.png)
```

Images are uploaded via the `kb_upload` tool (MCP) or `upload` CLI command before creating entries. When images are available on a branch, they will be listed in the prompt — use them in relevant entries where they add value (diagrams, figures from papers, etc.).

# Rules

1. **Atomicity (practical)**: one entry = one concept, but only split when it improves reuse and maintainability. As a rule of thumb, split into a separate entry only if you are confident the concept is general and likely to be reused across multiple future entries; otherwise, keep paper-specific findings (for example, “robustness results of paper X”) inside the main paper entry.
2. **Cross-references**: every connection to another entry must be an edge in frontmatter with label and description. Also use markdown links `[display text](/knowledge/slug.md)` in the body for readability.
3. **Reuse**: before creating a new entry, check if it already exists. If it does, update it instead of duplicating.
4. **Bidirectional edges**: when creating entry A with an edge to existing entry B, also update B's frontmatter to add an edge back to A.
5. **Tags are for classification only**: subject area (ml, systems), context (project-x). Do NOT use type names as tags.
6. **No comments in code or configs**.
7. **Slug format**: lowercase, hyphens, no special characters. Example: "Attention Is All You Need" → `attention-is-all-you-need`.
8. **LaTeX for formulas**: use LaTeX notation for mathematical formulas. Inline math uses `$...$`, display math uses `$$...$$`.

# CLI Tools

You have access to CLI tools for querying the knowledge base:

```bash
uv run python -m server.cli search "query"
uv run python -m server.cli list --type concept --tag ml
uv run python -m server.cli read /knowledge/rlhf.md
uv run python -m server.cli stats
```

Use these to explore the existing knowledge base beyond what's provided in the prompt context.
